from core.scan_result import ScanResult
from core.http_interface import HTTPInterface
from core.owasp_flags import OWASP_FLAGS, ENDPOINT_FLAGS

def test_business_flows(api_client, endpoints, risk_level):
    results = []
    for endpoint in endpoints:
        if OWASP_FLAGS.UABF not in endpoint.get_flags():
            continue
        http_interface = HTTPInterface(api_client.get_url())
        response = http_interface.send_custom(endpoint.method, endpoint.path)
        if response.status_code == 200:
            scan_evidence = f"Method: {endpoint.method}\nPath: {endpoint.path}\nStatus: {response.status_code}"
            sr = ScanResult(
                6,
                OWASP_FLAGS.UABF.value,
                endpoint,
                risk_level,
                8,
                "Unrestricted access to sensitive business flows: endpoint accessible without authentication",
                "Implement proper authentication and authorization",
                scan_evidence,
                "Unrestricted access",
                {}
            )
            results.append(sr)
    return results
